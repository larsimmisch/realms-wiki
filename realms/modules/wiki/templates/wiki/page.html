{% extends 'layout.html' %}

{% block feed %}
    <link href="{{ url_for('wiki.feed', name=name) }}" rel="feed" type="application/atom+xml" title={{ "Recent changes for page '{}'".format(name) }} >
{% endblock %}

{% block page_menu %}
  <div class="controls pull-right">
    <a class="btn btn-default btn-sm" href="{{ url_for('wiki.edit', name=name) }}">Edit</a>
    <a class="btn btn-default btn-sm" href="{{ url_for('wiki.history', name=name) }}">History</a>
  </div>
{% endblock %}

{% block body %}
  {% if commit %}
    <div id="page-action-bar">
      <form method="POST" action="{{ url_for('wiki.revert') }}" class="ajax-form" data-redirect="{{ url_for('wiki.page', name=name) }}">
        <input type="hidden" value="{{ name }}" name="name" />
        <input type="hidden" value="{{ commit }}" name="commit" />
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/
        <input type="submit" class="btn btn-danger btn-sm" title="Revert back to this revision" value="Revert" />
      </form>
    </div>
  {% endif %}
  <div id="page-content"></div>

{% endblock %}

{% block js %}
  <script>
    $(function(){
      var pageData = {{ page.data|tojson|safe }};
      $("#page-content").html(MDR.convert(pageData, {{ partials|d([])|tojson|safe }})).show();

      var match = pageData.match(/# (.*?)\n/);
      if (match && match[1]) {
        var title = $("title");
        title.text(title.text() + " - " + match[1]);
      }
    });
  </script>
{% endblock %}
